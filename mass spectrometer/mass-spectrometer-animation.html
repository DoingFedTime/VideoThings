<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mass Spectrometer Animation</title>
<div style="display: flex; justify-content: center; align-items: center; gap: 22px; flex-wrap: wrap; padding: 10px 0; color: inherit;">
  <a href="https://www.youtube.com/@Sam_Bent" target="_blank" aria-label="YouTube" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="100%" height="100%">
    <path fill="#FF3D00" d="M43.2,33.9c-0.4,2.1-2.1,3.7-4.2,4c-3.3,0.5-8.8,1.1-15,1.1c-6.1,0-11.6-0.6-15-1.1c-2.1-0.3-3.8-1.9-4.2-4C4.4,31.6,4,28.2,4,24c0-4.2,0.4-7.6,0.8-9.9c0.4-2.1,2.1-3.7,4.2-4C12.3,9.6,17.8,9,24,9c6.2,0,11.6,0.6,15,1.1c2.1,0.3,3.8,1.9,4.2,4c0.4,2.3,0.9,5.7,0.9,9.9C44,28.2,43.6,31.6,43.2,33.9z"/>
    <path fill="#FFF" d="M20 31L20 17 32 24z"/>
  </svg>
</a>
  <a href="https://twitter.com/DoingFedTime" target="_blank" aria-label="X" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="100%" height="100%" fill="#ccc">
    <path d="M 11 4 C 7.134 4 4 7.134 4 11 L 4 39 C 4 42.866 7.134 46 11 46 L 39 46 C 42.866 46 46 42.866 46 39 L 46 11 C 46 7.134 42.866 4 39 4 L 11 4 z M 13.085938 13 L 21.023438 13 L 26.660156 21.009766 L 33.5 13 L 36 13 L 27.789062 22.613281 L 37.914062 37 L 29.978516 37 L 23.4375 27.707031 L 15.5 37 L 13 37 L 22.308594 26.103516 L 13.085938 13 z M 16.914062 15 L 31.021484 35 L 34.085938 35 L 19.978516 15 L 16.914062 15 z"/>
  </svg>
</a>
<a href="https://doingfedtime.com" target="_blank" aria-label="DoingFedTime" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="100%" height="100%" stroke-width="3" stroke="#ccc" fill="none">
    <path d="M39.93,55.72A24.86,24.86,0,1,1,56.86,32.15a37.24,37.24,0,0,1-.73,6"/>
    <path d="M37.86,51.1A47,47,0,0,1,32,56.7"/>
    <path d="M32,7A34.14,34.14,0,0,1,43.57,30a34.07,34.07,0,0,1,.09,4.85"/>
    <path d="M32,7A34.09,34.09,0,0,0,20.31,32.46c0,16.2,7.28,21,11.66,24.24"/>
    <line x1="10.37" y1="19.9" x2="53.75" y2="19.9"/>
    <line x1="32" y1="6.99" x2="32" y2="56.7"/>
    <line x1="11.05" y1="45.48" x2="37.04" y2="45.48"/>
    <line x1="7.14" y1="32.46" x2="56.86" y2="31.85"/>
    <path d="M53.57,57,58,52.56l-8-8,4.55-2.91a.38.38,0,0,0-.12-.7L39.14,37.37a.39.39,0,0,0-.46.46L42,53.41a.39.39,0,0,0,.71.13L45.57,49Z"/>
  </svg>
</a>
<a href="https://www.linkedin.com/in/sambent/" target="_blank" aria-label="LinkedIn" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="100%" height="100%">
    <path fill="#0A66C2" d="M12.225 12.225h-1.778V9.44c0-.664-.012-1.519-.925-1.519-.926 0-1.068.724-1.068 1.47v2.834H6.676V6.498h1.707v.783h.024c.348-.594.996-.95 1.684-.925 1.802 0 2.135 1.185 2.135 2.728l-.001 3.14zM4.67 5.715a1.037 1.037 0 01-1.032-1.031c0-.566.466-1.032 1.032-1.032.566 0 1.031.466 1.032 1.032 0 .566-.466 1.032-1.032 1.032zm.889 6.51h-1.78V6.498h1.78v5.727zM13.11 2H2.885A.88.88 0 002 2.866v10.268a.88.88 0 00.885.866h10.226a.882.882 0 00.889-.866V2.865a.88.88 0 00-.889-.864z"/>
  </svg>
</a>
  <a href="https://github.com/DoingFedTime" target="_blank" aria-label="GitHub" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="100%" height="100%" fill="currentColor">
    <path d="M32 6C17.641 6 6 17.641 6 32c0 12.277 8.512 22.56 19.955 25.286-.592-.141-1.179-.299-1.755-.479V50.85c0 0-.975.325-2.275.325-3.637 0-5.148-3.245-5.525-4.875-.229-.993-.827-1.934-1.469-2.509-.767-.684-1.126-.686-1.131-.92-.01-.491.658-.471.975-.471 1.625 0 2.857 1.729 3.429 2.623 1.417 2.207 2.938 2.577 3.721 2.577.975 0 1.817-.146 2.397-.426.268-1.888 1.108-3.57 2.478-4.774-6.097-1.219-10.4-4.716-10.4-10.4 0-2.928 1.175-5.619 3.133-7.792C19.333 23.641 19 22.494 19 20.625c0-1.235.086-2.751.65-4.225 0 0 3.708.026 7.205 3.338C28.469 19.268 30.196 19 32 19s3.531.268 5.145.738c3.497-3.312 7.205-3.338 7.205-3.338.567 1.474.65 2.99.65 4.225 0 2.015-.268 3.19-.432 3.697C46.466 26.475 47.6 29.124 47.6 32c0 5.684-4.303 9.181-10.4 10.4 1.628 1.43 2.6 3.513 2.6 5.85v8.557c-.576.181-1.162.338-1.755.479C49.488 54.56 58 44.277 58 32 58 17.641 46.359 6 32 6zM33.813 57.93C33.214 57.972 32.61 58 32 58 32.61 58 33.213 57.971 33.813 57.93zM37.786 57.346c-1.164.265-2.357.451-3.575.554C35.429 57.797 36.622 57.61 37.786 57.346zM32 58c-.61 0-1.214-.028-1.813-.07C30.787 57.971 31.39 58 32 58zM29.788 57.9c-1.217-.103-2.411-.289-3.574-.554C27.378 57.61 28.571 57.797 29.788 57.9z"/>
  </svg>
</a>
  
  <a href="https://bsky.app/profile/doingfedtime.bsky.social" target="_blank" aria-label="Bluesky" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="100%" height="100%">
    <linearGradient id="vDWP7DBQDc96tCF4UoN6na" x1="24" x2="24" y1="5.565" y2="40.968" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="#3d9cff"/>
      <stop offset="1" stop-color="#1185fe"/>
    </linearGradient>
    <path fill="url(#vDWP7DBQDc96tCF4UoN6na)" d="M12.104,7.999C16.919,11.614,22.099,18.944,24,22.877c1.902-3.933,7.081-11.263,11.896-14.878	C39.371,5.391,45,3.373,45,9.795c0,1.283-0.735,10.774-1.167,12.315c-1.499,5.357-6.962,6.724-11.821,5.897	C40.506,29.452,42.667,34.241,38,39.03c-8.863,9.094-12.738-2.282-13.732-5.197c-0.182-0.534-0.267-0.784-0.268-0.572	c-0.001-0.213-0.086,0.037-0.268,0.572C22.738,36.748,18.863,48.124,10,39.03c-4.667-4.789-2.506-9.577,5.988-11.023	c-4.86,0.827-10.323-0.539-11.821-5.897C3.735,20.569,3,11.077,3,9.795C3,3.373,8.63,5.391,12.104,7.999L12.104,7.999z"/>
  </svg>
</a>
  <a href="https://rumble.com/c/SamBent" target="_blank" aria-label="Rumble" style="width: 32px; height: 32px;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="100%" height="100%" fill="#8bc34a">
      <path d="M38.544,16.899C34.578,13.008,23.053,5,16,5c-3,0-6,1-8,6S6,24,6,24s0,8,2,13s5,6,8,6c7.053,0,18.578-8.008,22.544-11.899C40.204,29.473,42,27.422,42,24C42,20.578,40.204,18.527,38.544,16.899z"/>
      <path fill="currentColor" d="M16.472,19.839c-0.296,2.881-0.296,5.441,0,8.322c0.209,2.031,2.321,3.298,4.187,2.469c1.979-0.879,4.578-2.234,7.324-4.22c1.629-1.178,1.629-3.642,0-4.82c-2.746-1.986-5.345-3.342-7.324-4.22C18.793,16.541,16.681,17.808,16.472,19.839z"/>
    </svg>
  </a>
  <a href="https://www.facebook.com/profile.php?id=61552282253130" target="_blank" aria-label="Facebook" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="100%" height="100%">
    <path fill="#039be5" d="M24 5A19 19 0 1 0 24 43A19 19 0 1 0 24 5Z"/>
    <path fill="currentColor" d="M26.572,29.036h4.917l0.772-4.995h-5.69v-2.73c0-2.075,0.678-3.915,2.619-3.915h3.119v-4.359c-0.548-0.074-1.707-0.236-3.897-0.236c-4.573,0-7.254,2.415-7.254,7.917v3.323h-4.701v4.995h4.701v13.729C22.089,42.905,23.032,43,24,43c0.875,0,1.729-0.08,2.572-0.194V29.036z"/>
  </svg>
</a>
  <a href="mailto:contact@sambent.com" aria-label="Email" style="width: 32px; height: 32px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1920" width="100%" height="100%" fill="currentColor">
    <path d="M0 1694.235h1920V226H0v1468.235ZM112.941 376.664V338.94H1807.06v37.723L960 1111.233l-847.059-734.57ZM1807.06 526.198v950.513l-351.134-438.89-88.32 70.475 378.353 472.998H174.042l378.353-472.998-88.32-70.475-351.134 438.89V526.198L960 1260.768l847.059-734.57Z" fill-rule="evenodd"/>
  </svg>
</a>
  <a href="https://darkwebdaily.live" target="_blank" aria-label="DarkwebDaily" style="width: 32px; height: 32px;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="100%" height="100%">
      <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM8.65 14.77C8.54 15.07 8.25 15.26 7.95 15.26C7.86 15.26 7.78 15.25 7.69 15.21C6.88 14.91 6.2 14.32 5.77 13.55C4.77 11.75 5.39 9.4 7.14 8.31L9.48 6.86C10.34 6.33 11.35 6.17 12.31 6.42C13.27 6.67 14.08 7.3 14.57 8.18C15.57 9.98 14.95 12.33 13.2 13.42L12.94 13.61C12.6 13.85 12.13 13.77 11.89 13.44C11.65 13.1 11.73 12.63 12.06 12.39L12.37 12.17C13.49 11.47 13.87 10.02 13.26 8.91C12.97 8.39 12.5 8.02 11.94 7.87C11.38 7.72 10.79 7.81 10.28 8.13L7.92 9.59C6.84 10.26 6.46 11.71 7.07 12.83C7.32 13.28 7.72 13.63 8.2 13.81C8.59 13.95 8.79 14.38 8.65 14.77ZM16.92 15.65L14.58 17.1C13.99 17.47 13.33 17.65 12.66 17.65C12.36 17.65 12.05 17.61 11.75 17.53C10.79 17.28 9.98 16.65 9.5 15.77C8.5 13.97 9.12 11.62 10.87 10.53L11.13 10.34C11.47 10.1 11.94 10.18 12.18 10.51C12.42 10.85 12.34 11.32 12.01 11.56L11.7 11.78C10.58 12.48 10.2 13.93 10.81 15.04C11.1 15.56 11.57 15.93 12.13 16.08C12.69 16.23 13.28 16.14 13.79 15.82L16.13 14.37C17.21 13.7 17.59 12.25 16.98 11.13C16.73 10.68 16.33 10.33 15.85 10.15C15.46 10.01 15.26 9.58 15.41 9.19C15.55 8.8 15.99 8.6 16.37 8.75C17.18 9.05 17.86 9.64 18.29 10.41C19.28 12.21 18.67 14.56 16.92 15.65Z" fill="currentColor"/>
    </svg>
  </a>
</div>
<style>
  :root {
    --primary-color: #6200ea;
    --secondary-color: #03dac6;
    --accent-color: #ff4081;
    --dark-bg: #121212;
    --darker-bg: #0a0a0a;
    --light-text: #f8f9fa;
    --border-color: #333;
    --highlight: #bb86fc;
    --ion-color: #ff4081;
    --electron-color: #03dac6;
    --neutral-color: #ffffff;
  }

  body {
    margin: 0;
    background: var(--dark-bg);
    color: var(--light-text);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow-x: hidden;
  }

  .container {
    position: relative;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    gap: 20px;
    padding: 20px;
  }

  header {
    text-align: center;
    margin-bottom: 10px;
    width: 100%;
  }

  h1 {
    font-size: 2.2rem;
    margin-bottom: 0.3rem;
    color: var(--highlight);
    text-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
  }

  .description {
    max-width: 800px;
    margin: 0 auto 20px;
    font-size: 1rem;
    line-height: 1.5;
    text-align: center;
    color: #bbb;
  }

  .controls {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
    justify-content: center;
  }

  button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
    min-width: 120px;
    z-index: 100; /* Ensure buttons are clickable */
  }

  button:hover {
    background: #7c4dff;
    transform: translateY(-2px);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
  }

  button:active {
    transform: translateY(0);
  }

  button:disabled {
    background: #555;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .speed-control {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #222;
    padding: 5px 10px;
    border-radius: 5px;
  }

  .speed-control label {
    font-size: 0.9rem;
    white-space: nowrap;
  }

  .speed-control input {
    accent-color: var(--primary-color);
  }

  .ms-system {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 95%;
    max-width: 1200px;
    background: var(--darker-bg);
    border-radius: 15px;
    padding: 20px 10px 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    position: relative;
    margin-top: 20px;
  }

  .ms-components {
    display: flex;
    width: 100%;
    justify-content: space-around;
    align-items: center;
    margin-bottom: 30px;
    position: relative;
  }

  .connector {
    height: 8px;
    background: linear-gradient(90deg, rgba(255,255,255,0.1), var(--accent-color), rgba(255,255,255,0.1));
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    left: 10%;
    right: 10%;
    border-radius: 4px;
    z-index: 1;
  }

  .module {
    background: #1e1e1e;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    min-width: 120px;
    max-width: 180px;
    min-height: 180px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--light-text);
    font-size: 1rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    z-index: 3;
    transition: all 0.3s;
    position: relative;
  }

  .module:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .module.active {
    border-color: var(--highlight);
    box-shadow: 0 0 20px rgba(187, 134, 252, 0.3);
  }

  .module small {
    display: block;
    font-size: 0.85em;
    color: #aaa;
    margin-top: 8px;
  }

  .module-icon {
    font-size: 2rem;
    margin-bottom: 15px;
    color: var(--secondary-color);
  }

  .visualization-area {
    width: 100%;
    height: 300px;
    position: relative;
    background: #0d0d0d;
    border-radius: 10px;
    border: 1px solid #333;
    overflow: hidden;
    margin-top: 30px;
  }

  /* Ion Source Area */
  .ion-source-area {
    position: absolute;
    top: 0;
    left: 0;
    width: 25%;
    height: 100%;
    border-right: 1px dashed #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .molecule {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--neutral-color);
    position: absolute;
    top: 50%;
    left: 12.5%;
    transform: translate(-50%, -50%);
    opacity: 0;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    transition: opacity 0.5s;
  }

  .electron-beam {
    position: absolute;
    top: 0;
    left: 12.5%;
    height: 0;
    width: 2px;
    background: var(--electron-color);
    transform: translateX(-50%);
    box-shadow: 0 0 5px var(--electron-color);
    opacity: 0;
    transition: height 1s, opacity 0.5s;
  }

  /* Mass Analyzer Area */
  .mass-analyzer-area {
    position: absolute;
    top: 0;
    left: 25%;
    width: 50%;
    height: 100%;
    border-right: 1px dashed #333;
    overflow: hidden;
  }

  .magnetic-field {
    position: absolute;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 80%;
    border-radius: 50%;
    border: 2px dashed var(--primary-color);
    opacity: 0;
    transition: opacity 1s;
  }

  .magnetic-field::before {
    content: "B";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    font-weight: bold;
    color: var(--primary-color);
    opacity: 0.5;
  }

  .ion-path {
    position: absolute;
    width: 60%;
    height: 60%;
    top: 20%;
    left: 20%;
    border-radius: 50%;
    border: 2px solid var(--ion-color);
    clip-path: inset(0 0 50% 50%);
    opacity: 0;
    transition: opacity 1s;
  }

  .ion {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: var(--ion-color);
    position: absolute;
    opacity: 0;
    box-shadow: 0 0 10px rgba(255, 64, 129, 0.5);
  }

  .ion-charge {
    position: absolute;
    font-size: 0.65rem;
    color: white;
    top: -12px;
    right: -5px;
  }

  /* Detector Area */
  .detector-area {
    position: absolute;
    top: 0;
    left: 75%;
    width: 25%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .detector-plate {
    width: 60%;
    height: 70%;
    background: #333;
    border-radius: 5px;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-evenly;
    opacity: 0.7;
    transition: opacity 0.5s;
  }

  .detector-plate.active {
    opacity: 1;
    box-shadow: 0 0 15px rgba(3, 218, 198, 0.3);
  }

  .detection-point {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--secondary-color);
    opacity: 0;
    transition: opacity 0.3s, transform 0.3s;
  }

  .detection-point.active {
    opacity: 1;
    transform: scale(1.5);
    box-shadow: 0 0 10px var(--secondary-color);
  }

  .signal-line {
    position: absolute;
    top: 10px;
    right: -20px;
    width: 3px;
    height: 0;
    background: var(--secondary-color);
    transition: height 0.5s;
  }

  /* Spectrum Display */
  .spectrum-display {
    width: 100%;
    height: 200px;
    background: #0d0d0d;
    border-radius: 10px;
    border: 1px solid #333;
    position: relative;
    margin-top: 20px;
    overflow: hidden;
  }

  .spectrum-axes {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .spectrum-x-axis {
    position: absolute;
    bottom: 30px;
    left: 50px;
    right: 20px;
    height: 2px;
    background: #555;
  }

  .spectrum-y-axis {
    position: absolute;
    bottom: 30px;
    left: 50px;
    width: 2px;
    height: calc(100% - 50px);
    background: #555;
  }

  .spectrum-x-label {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.9rem;
    color: #aaa;
  }

  .spectrum-y-label {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%) rotate(-90deg);
    font-size: 0.9rem;
    color: #aaa;
  }

  .mass-markers {
    position: absolute;
    bottom: 15px;
    left: 50px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    padding-right: 10px;
    font-size: 0.8rem;
    color: #777;
  }

  .intensity-markers {
    position: absolute;
    left: 20px;
    top: 20px;
    bottom: 30px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #777;
  }

  .spectrum-peak {
    position: absolute;
    bottom: 32px;
    width: 4px;
    background: var(--ion-color);
    transform-origin: bottom;
    transform: scaleY(0);
    transition: transform 0.5s;
  }

  .info-panel {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 15px;
    border-radius: 10px;
    max-width: 300px;
    font-size: 0.9rem;
    line-height: 1.4;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
    z-index: 10;
    border: 1px solid var(--highlight);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  }

  .module:hover .info-panel {
    opacity: 1;
    visibility: visible;
  }

  .caption {
    font-size: 1.1em;
    text-align: center;
    max-width: 800px;
    min-height: 3em;
    color: var(--light-text);
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
    transition: all 0.5s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .step-indicator {
    display: flex;
    justify-content: space-between;
    width: 80%;
    max-width: 600px;
    margin: 20px auto;
    position: relative;
  }

  .step {
    background: #333;
    color: #999;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 2;
    font-weight: bold;
    transition: all 0.3s;
  }

  .step.active {
    background: var(--highlight);
    color: #000;
  }

  .step-line {
    position: absolute;
    top: 50%;
    left: 15px;
    right: 15px;
    height: 3px;
    background: #333;
    z-index: 1;
    transform: translateY(-50%);
  }

  .step-progress {
    position: absolute;
    top: 50%;
    left: 15px;
    height: 3px;
    background: var(--highlight);
    width: 0%;
    z-index: 1;
    transform: translateY(-50%);
    transition: width 0.5s linear;
  }

  .legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9rem;
    background: rgba(0, 0, 0, 0.3);
    padding: 5px 10px;
    border-radius: 5px;
  }

  .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }

  .formula {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    background: rgba(0, 0, 0, 0.3);
    padding: 3px 6px;
    border-radius: 4px;
    margin: 0 2px;
  }

  .sample-info {
    margin: 15px 0;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    border: 1px solid #333;
    max-width: 600px;
    text-align: center;
  }

  .sample-formula {
    font-size: 1.2rem;
    margin-bottom: 5px;
    color: var(--secondary-color);
  }

  .fragment-info {
    margin-top: 5px;
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
  }

  .fragment {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .ms-components {
      flex-direction: column;
      gap: 20px;
    }
    
    .connector {
      height: 80%;
      width: 8px;
      left: 50%;
      top: 10%;
      transform: translateX(-50%);
    }
    
    .visualization-area {
      height: 400px;
    }
    
    .ion-source-area {
      width: 100%;
      height: 33.33%;
      border-right: none;
      border-bottom: 1px dashed #333;
    }
    
    .mass-analyzer-area {
      width: 100%;
      height: 33.33%;
      left: 0;
      top: 33.33%;
      border-right: none;
      border-bottom: 1px dashed #333;
    }
    
    .detector-area {
      width: 100%;
      left: 0;
      top: 66.66%;
      height: 33.33%;
    }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Mass Spectrometer</h1>
    <p class="description">
      Visualizing how a mass spectrometer ionizes molecules, separates ions by mass-to-charge ratio, 
      and produces a mass spectrum for chemical analysis.
    </p>
  </header>
  
  <div class="controls">
    <button id="startBtn">Start Animation</button>
    <button id="resetBtn">Reset</button>
    <div class="speed-control">
      <label for="speedControl">Animation Speed:</label>
      <input type="range" id="speedControl" min="0.5" max="2" step="0.1" value="1">
    </div>
  </div>
  
  <div class="sample-info">
    <div class="sample-formula">CH<sub>3</sub>CH<sub>2</sub>OH (Ethanol)</div>
    <div>Molecular Weight: 46 g/mol</div>
    <div class="fragment-info">
      <div class="fragment">M<sup>+</sup> (46 m/z)</div>
      <div class="fragment">CH<sub>3</sub>CH<sub>2</sub><sup>+</sup> (29 m/z)</div>
      <div class="fragment">CH<sub>3</sub><sup>+</sup> (15 m/z)</div>
    </div>
  </div>
  
  <div class="step-indicator">
    <div class="step-line"></div>
    <div class="step-progress" id="stepProgress"></div>
    <div class="step" data-step="1">1</div>
    <div class="step" data-step="2">2</div>
    <div class="step" data-step="3">3</div>
    <div class="step" data-step="4">4</div>
  </div>
  
  <div class="ms-system">
    <div class="ms-components">
      <div class="connector"></div>
      
      <div class="module" id="ionSource">
        <div class="module-icon">⚡</div>
        Ion Source
        <small>Electron Impact (EI)</small>
        <div class="info-panel">
          The sample is vaporized and bombarded with high-energy electrons. 
          This removes electrons from the molecules, creating positive ions and fragment ions.
        </div>
      </div>
      
      <div class="module" id="massAnalyzer">
        <div class="module-icon">🧲</div>
        Mass Analyzer
        <small>Magnetic Sector</small>
        <div class="info-panel">
          Ions are accelerated through a magnetic field where they travel in circular paths. 
          The radius of the path depends on the mass-to-charge ratio (m/z), separating ions of different masses.
        </div>
      </div>
      
      <div class="module" id="detector">
        <div class="module-icon">📊</div>
        Detector
        <small>Electron Multiplier</small>
        <div class="info-panel">
          Detects ions that make it through the mass analyzer and amplifies the signal.
          The data is then processed to create a mass spectrum showing intensity vs. m/z.
        </div>
      </div>
    </div>
    
    <div class="visualization-area">
      <!-- Ion Source Area -->
      <div class="ion-source-area">
        <div class="molecule" id="molecule"></div>
        <div class="electron-beam" id="electronBeam"></div>
      </div>
      
      <!-- Mass Analyzer Area -->
      <div class="mass-analyzer-area">
        <div class="magnetic-field" id="magneticField"></div>
        <div class="ion-path" id="ionPath"></div>
      </div>
      
      <!-- Detector Area -->
      <div class="detector-area">
        <div class="detector-plate" id="detectorPlate">
          <div class="detection-point" id="detectionPoint1"></div>
          <div class="detection-point" id="detectionPoint2"></div>
          <div class="detection-point" id="detectionPoint3"></div>
          <div class="signal-line" id="signalLine"></div>
        </div>
      </div>
    </div>
    
    <div class="caption" id="caption">Press "Start Animation" to begin the mass spectrometry process.</div>
  </div>
  
  <div class="spectrum-display">
    <div class="spectrum-axes">
      <div class="spectrum-x-axis"></div>
      <div class="spectrum-y-axis"></div>
      <div class="spectrum-x-label">m/z (mass-to-charge ratio)</div>
      <div class="spectrum-y-label">Relative Intensity (%)</div>
      <div class="mass-markers">
        <span>0</span>
        <span>10</span>
        <span>20</span>
        <span>30</span>
        <span>40</span>
        <span>50</span>
        <span>60</span>
      </div>
      <div class="intensity-markers">
        <span>100%</span>
        <span>50%</span>
        <span>0%</span>
      </div>
    </div>
    <div id="spectrumPeaks"></div>
  </div>
  
  <div class="legend">
    <div class="legend-item">
      <div class="legend-color" style="background: var(--neutral-color);"></div>
      <span>Neutral Molecule</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--ion-color);"></div>
      <span>Ions</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--electron-color);"></div>
      <span>Electron Beam</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--primary-color);"></div>
      <span>Magnetic Field</span>
    </div>
  </div>
</div>

<script>
// Using window.onload to ensure all elements are available
window.onload = function() {
  // Elements
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const speedControl = document.getElementById('speedControl');
  const caption = document.getElementById('caption');
  const stepProgress = document.getElementById('stepProgress');
  const steps = document.querySelectorAll('.step');
  
  // Module elements
  const ionSource = document.getElementById('ionSource');
  const massAnalyzer = document.getElementById('massAnalyzer');
  const detector = document.getElementById('detector');
  
  // Visualization elements
  const molecule = document.getElementById('molecule');
  const electronBeam = document.getElementById('electronBeam');
  const magneticField = document.getElementById('magneticField');
  const ionPath = document.getElementById('ionPath');
  const detectorPlate = document.getElementById('detectorPlate');
  const detectionPoint1 = document.getElementById('detectionPoint1');
  const detectionPoint2 = document.getElementById('detectionPoint2');
  const detectionPoint3 = document.getElementById('detectionPoint3');
  const signalLine = document.getElementById('signalLine');
  const spectrumPeaks = document.getElementById('spectrumPeaks');
  
  // Mass spectrum data for ethanol
  const peaks = [
    { mz: 15, intensity: 35, label: "CH₃⁺" },
    { mz: 29, intensity: 60, label: "CH₃CH₂⁺" },
    { mz: 31, intensity: 30, label: "CH₂OH⁺" },
    { mz: 46, intensity: 100, label: "C₂H₅OH⁺ (M⁺)" }
  ];
  
  // Variables - initialize with console.log to confirm code execution
  console.log("Initializing variables");
  let animationStarted = false;
  let animationSpeed = 1;
  let currentStep = 0;
  let totalSteps = 4;
  let animationTimer;
  let ions = [];
  
  // Speed control
  speedControl.addEventListener('input', function() {
    animationSpeed = parseFloat(speedControl.value);
  });
  
  // Start animation - with error handling
  startBtn.addEventListener('click', function() {
    console.log("Start button clicked - Event listener triggered");
    try {
      if (!animationStarted) {
        console.log("Animation not started - Starting animation");
        animationStarted = true;
        startBtn.textContent = 'Running...';
        startBtn.disabled = true;
        
        // Add a small delay to ensure DOM updates
        setTimeout(function() {
          console.log("Running animation after delay");
          runAnimation();
        }, 50);
      } else {
        console.log("Animation already started");
      }
    } catch (error) {
      console.error("Error starting animation:", error);
      alert("Animation error: " + error.message);
    }
    console.log("Start button clicked - Event listener finished");
  });
  
  // Reset animation
  resetBtn.addEventListener('click', function() {
    resetAnimation();
  });
  
  function resetAnimation() {
    // Clear any existing animation timers
    clearTimeout(animationTimer);
    
    // Reset animation state
    animationStarted = false;
    currentStep = 0;
    
    // Reset UI elements
    startBtn.textContent = 'Start Animation';
    startBtn.disabled = false;
    caption.textContent = 'Press "Start Animation" to begin the mass spectrometry process.';
    
    // Reset modules
    ionSource.classList.remove('active');
    massAnalyzer.classList.remove('active');
    detector.classList.remove('active');
    
    // Reset visualization
    molecule.style.opacity = '0';
    electronBeam.style.opacity = '0';
    electronBeam.style.height = '0';
    magneticField.style.opacity = '0';
    ionPath.style.opacity = '0';
    detectorPlate.classList.remove('active');
    detectionPoint1.classList.remove('active');
    detectionPoint2.classList.remove('active');
    detectionPoint3.classList.remove('active');
    signalLine.style.height = '0';
    
    // Remove ions
    ions.forEach(ion => {
      if (ion.element) {
        ion.element.remove();
      }
    });
    ions = [];
    
    // Reset spectrum
    const existingPeaks = document.querySelectorAll('.spectrum-peak');
    existingPeaks.forEach(peak => peak.remove());
    
    // Reset progress
    stepProgress.style.width = '0%';
    steps.forEach(step => step.classList.remove('active'));
  }
  
  function updateStep(step) {
    currentStep = step;
    const progressPercentage = (step / totalSteps) * 100;
    stepProgress.style.width = `${progressPercentage}%`;
    
    // Update step indicators
    steps.forEach(s => {
      if (parseInt(s.dataset.step) <= step) {
        s.classList.add('active');
      } else {
        s.classList.remove('active');
      }
    });
  }
  
  function createIon(mz, label, delay) {
    console.log(`Creating ion: mz=${mz}, label=${label}, delay=${delay}`);
    
    animationTimer = setTimeout(() => {
      const ion = document.createElement('div');
      ion.className = 'ion';
      ion.style.top = '50%';
      ion.style.left = '12.5%';
      ion.style.transform = 'translate(-50%, -50%)';
      ion.style.opacity = '1'; // Ensure ion is visible
      
      const charge = document.createElement('span');
      charge.className = 'ion-charge';
      charge.textContent = '+';
      ion.appendChild(charge);
      
      document.querySelector('.mass-analyzer-area').appendChild(ion);
      
      // Store ion info
      const ionObj = {
        element: ion,
        mz: mz,
        label: label,
        angle: 0
      };
      ions.push(ionObj);
      
      // Start ion animation
      animateIon(ionObj);
    }, delay / animationSpeed);
  }
  
  function animateIon(ion) {
    console.log(`Animating ion with mz=${ion.mz}`);
    const radius = Math.min(ion.mz * 2, 100); // Adjusting radius based on m/z
    const speedFactor = 1 / ion.mz * 50; // Heavier ions move slower
    
    const moveIon = () => {
      ion.angle += speedFactor * animationSpeed * 0.05;
      
      // Calculate position based on circular path
      const centerX = 50; // Center X in percentage
      const centerY = 50; // Center Y in percentage
      
      const x = centerX + radius * Math.cos(ion.angle);
      const y = centerY + radius * Math.sin(ion.angle);
      
      ion.element.style.left = `${x}%`;
      ion.element.style.top = `${y}%`;
      
      // Continue animation until ion leaves analyzer
      if (ion.angle < Math.PI * 1.5) {
        requestAnimationFrame(moveIon);
      } else {
        // Ion reaches detector
        ion.element.style.opacity = '0';
        setTimeout(() => {
          console.log(`Ion with mz=${ion.mz} reached detector`);
          if (ion.element) {
            ion.element.remove();
          }
          
          // Activate detection point based on m/z
          if (ion.mz === 15) {
            detectionPoint1.classList.add('active');
          } else if (ion.mz === 29) {
            detectionPoint2.classList.add('active');
          } else {
            detectionPoint3.classList.add('active');
          }
          
          // Create peak in spectrum
          createSpectrumPeak(ion.mz, ion.label);
        }, 100 / animationSpeed);
      }
    };
    
    // Start moving the ion
    moveIon();
  }
  
  function createSpectrumPeak(mz, label) {
    console.log(`Creating spectrum peak: mz=${mz}, label=${label}`);
    
    const peakData = peaks.find(p => p.mz === mz);
    if (!peakData) {
      console.error("Peak data not found for mz:", mz);
      return;
    }
    
    const maxMz = 60; // Maximum m/z value to display
    const peakPosition = (peakData.mz / maxMz) * 100;
    
    const peak = document.createElement('div');
    peak.className = 'spectrum-peak';
    peak.style.left = `${50 + (peakPosition * 0.8)}px`; // Offset for y-axis + scaled position
    peak.style.height = `${peakData.intensity * 1.3}px`; // Scaled height
    
    // Add label
    const peakLabel = document.createElement('div');
    peakLabel.textContent = `${peakData.mz}`;
    peakLabel.style.position = 'absolute';
    peakLabel.style.top = '-20px';
    peakLabel.style.left = '50%';
    peakLabel.style.transform = 'translateX(-50%)';
    peakLabel.style.fontSize = '0.8rem';
    peakLabel.style.color = '#ccc';
    peak.appendChild(peakLabel);
    
    spectrumPeaks.appendChild(peak);
    
    // Animate the peak
    setTimeout(() => {
      peak.style.transform = `scaleY(1)`;
    }, 10);
  }
  
  function runAnimation() {
      console.log("runAnimation - Function started");
      
      // Step 1: Sample introduction and ionization
      updateStep(1);
      ionSource.classList.add('active');
      
      caption.textContent = 'Sample molecules are vaporized and enter the ion source where they are bombarded with high-energy electrons.';
      
      // Show molecule
      molecule.style.opacity = '1';
      
      // Show electron beam after delay
      animationTimer = setTimeout(() => {
        console.log("Showing electron beam");
        electronBeam.style.opacity = '1';
        electronBeam.style.height = '100%';
        
        // Create ions after ionization
        animationTimer = setTimeout(() => {
          console.log("Ionization occurring");
          molecule.style.opacity = '0';
          
          // Create fragment ions with delays between them
          createIon(46, "C₂H₅OH⁺", 0);     // Molecular ion
          createIon(29, "CH₃CH₂⁺", 500);   // Fragment ion
          createIon(15, "CH₃⁺", 1000);     // Fragment ion
        }, 2000 / animationSpeed);
      }, 1000 / animationSpeed);
      
      // Step 2: Mass analysis
      animationTimer = setTimeout(() => {
        console.log("Moving to step 2: Mass analysis");
        updateStep(2);
        massAnalyzer.classList.add('active');
        caption.textContent = 'Ions are accelerated into the mass analyzer where a magnetic field separates them based on their mass-to-charge (m/z) ratio.';
        
        // Show magnetic field
        magneticField.style.opacity = '1';
        ionPath.style.opacity = '1';
      }, 4000 / animationSpeed);
      
      // Step 3: Detection
      animationTimer = setTimeout(() => {
        console.log("Moving to step 3: Detection");
        updateStep(3);
        detector.classList.add('active');
        caption.textContent = 'Ions reach the detector where they generate an electronic signal proportional to their abundance.';
        
        detectorPlate.classList.add('active');
        
        // Show signal line
        animationTimer = setTimeout(() => {
          signalLine.style.height = '100%';
        }, 1000 / animationSpeed);
      }, 8000 / animationSpeed);
      
      // Step 4: Mass spectrum
      animationTimer = setTimeout(() => {
        console.log("Moving to step 4: Mass spectrum");
        updateStep(4);
        caption.textContent = 'The data is processed to create a mass spectrum showing the relative abundance of each ion fragment by m/z ratio.';
        
        startBtn.textContent = 'Completed';
        
        // Create remaining peaks for a complete spectrum
        const remainingPeaks = peaks.filter(p =>
          !ions.some(ion => ion.mz === p.mz)
        );
        
        console.log("Creating remaining peaks:", remainingPeaks.length);
        
        remainingPeaks.forEach((peak, index) => {
          animationTimer = setTimeout(() => {
            createSpectrumPeak(peak.mz, peak.label);
          }, index * 500 / animationSpeed);
        });
      }, 12000 / animationSpeed);
      console.log("runAnimation - Function finished");
    }
  };
</script>
</body>
</html>